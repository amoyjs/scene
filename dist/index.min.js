(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports,require("pixi.js"),require("eventemitter3")):"function"==typeof define&&define.amd?define(["exports","pixi.js","eventemitter3"],b):(a=a||self,b(a.SceneKit={},a.PIXI,a.EventEmitter))})(this,function(a,b,c){'use strict';function d(a,c){function b(){this.constructor=a}o(a,c),a.prototype=null===c?Object.create(c):(b.prototype=c.prototype,new b)}function e(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new(c||(c=Promise))(function(c,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d["throw"](a))}catch(a){f(a)}}function i(a){a.done?c(a.value):e(a.value).then(g,h)}i((d=d.apply(a,b||[])).next())})}function f(a,b){function c(a){return function(b){return d([a,b])}}function d(c){if(e)throw new TypeError("Generator is already executing.");for(;k;)try{if(e=1,h&&(i=2&c[0]?h["return"]:c[0]?h["throw"]||((i=h["return"])&&i.call(h),0):h.next)&&!(i=i.call(h,c[1])).done)return i;switch((h=0,i)&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return k.label++,{value:c[1],done:!1};case 5:k.label++,h=c[1],c=[0];continue;case 7:c=k.ops.pop(),k.trys.pop();continue;default:if((i=k.trys,!(i=0<i.length&&i[i.length-1]))&&(6===c[0]||2===c[0])){k=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){k.label=c[1];break}if(6===c[0]&&k.label<i[1]){k.label=i[1],i=c;break}if(i&&k.label<i[2]){k.label=i[2],k.ops.push(c);break}i[2]&&k.ops.pop(),k.trys.pop();continue;}c=b.call(a,k)}catch(a){c=[6,a],h=0}finally{e=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}var e,h,i,j,k={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return j={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(j[Symbol.iterator]=function(){return this}),j}function g(){for(var b=0,c=0,d=arguments.length;c<d;c++)b+=arguments[c].length;for(var e=Array(b),f=0,c=0;c<d;c++)for(var g=arguments[c],a=0,h=g.length;a<h;a++,f++)e[f]=g[a];return e}function h(){// @ts-ignore
if("undefined"!=typeof canvas)// @ts-ignore
return canvas;var a=document.createElement("canvas");return a.id="GAME_VIEW",document.body.appendChild(a),a}function i(a){a.children.map(function(a){return i(a)}),a.removeChildren()}function j(){if(window.orientation===void 0)return!0;var a=+window.orientation/90%2;return 1==a||-1===a}function k(){return w.prototype.game}function l(){return k().stage.children.find(function(a){return a.name===s.currentScene.name})}function m(a){Array.isArray(a)?a.map(function(a){return a(A)}):"function"==typeof a?a(A):console.error("extendsion "+a+" must be a function")}function n(a){void 0===a&&(a={scenes:{}});var c=a.view;a=Object.assign(B,a),a.view=c||h();var d={PIXI:b,Route:s,Scene:w,Resource:r,configure:a};A.emit("beforeCreate",d);var e=new z(a);return A.emit("created",p(p({},d),{game:e})),A.emit("sceneCreate",p(p({},d),{game:e})),A.emit("sceneCreated",p(p({},d),{game:e})),e}c=c&&Object.prototype.hasOwnProperty.call(c,"default")?c["default"]:c;/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */ /* global Reflect, Promise */var o=function(a,c){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,c){a.__proto__=c}||function(a,c){for(var b in c)c.hasOwnProperty(b)&&(a[b]=c[b])},o(a,c)},p=function(){return p=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++)for(var e in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e]);return a},p.apply(this,arguments)},q={add:function(){for(var a,c=[],d=0;d<arguments.length;d++)c[d]=arguments[d];b.Loader.shared.resources[c[0]]||(a=b.Loader.shared).add.apply(a,c)},Load:function(a,b){var c=this;Object.keys(a).map(function(d){var e=/\.(svg|png|gif|jpe?g)/.test(a[d]),f=/\.(json)/.test(a[d])||Array.isArray(a[d]),g=[d,a[d]],h=p({},b);if(Array.isArray(a[d])){var i=a[d].find(function(a){return /\.(svg|png|gif|jpe?g)/.test(a)}),j=a[d].find(function(a){return /\.(json)/.test(a)});i&&j&&(g[1]=j,h.metadata={jsonImage:i})}(e||f)&&g.push(h),c.add.apply(c,g)})},onLoaded:function(a){void 0===a&&(a=function(){}),b.Loader.shared.load(function(){return a(b.Loader.shared.resources)})}},r=/** @class */function(){function a(){}return a.use=function(a){this.resourceGetters.push(a)},a.useLoad=function(a){this.resourceGetters.push(a),console.warn("'Resource.useLoad()' will be deprecated in next major version, use 'Resource.use()' to instead.")},a.getLoad=function(){var a=this.resourceGetters.filter(function(a){return"object"==typeof a}).reduce(function(a,b){return Object.assign(a,b)},{}),b=this.resourceGetters.filter(function(a){return"function"==typeof a}).reduce(function(a,b){return Object.assign(a,b())},{});return Object.assign(a,b)},a.optionSetting=function(a){this.options=a},a.Load=function(a){return void 0===a&&(a=function(){}),e(this,void 0,void 0,function(){var c=this;return f(this,function(){return q.Load(this.getLoad(),this.options),this.resourceGetters=[],[2/*return*/,new Promise(function(d){return b.Loader.shared.load(function(){d(b.Loader.shared.resources),a(b.Loader.shared.resources),c._onLoaded(b.Loader.shared.resources)})})]})})},a.onLoading=function(a){void 0===a&&(a=function(){}),b.Loader.shared.on("progress",function(b,c){return a(b.progress,c.name,c.url)})},a.onLoaded=function(a){void 0===a&&(a=function(){}),this._onLoaded=a},a._onLoaded=function(){},a.resourceGetters=[],a}(),s=/** @class */function(){function a(){}return a.push=function(a){this.scenes[a.name]=a},a.to=function(a,b){void 0===b&&(b={}),this.isScene(a)&&this.currentSceneName!==a&&(this.pendingSceneName=a,this.query=b,this.history.push(a),this.setCurrentScene(this.pendingSceneName))},a.back=function(a){void 0===a&&(a={}),1>=this.history.length||(this.history.pop(),this.to(this.history.pop(),a))},a.getQuery=function(a){return a?this.query[a]:this.query},a.update=function(){this.currentScene&&this.currentScene.canUpdate&&this.currentScene.update()},a.setCurrentScene=function(a){return this.isScene(a)?void(// hide all scenes
// set current scene
this.game.stage.children.map(function(a){return a.visible=!1}),this.currentScene=this.scenes[a],this.currentScene.stage.visible=!0,this.fetchNextScene(),this.stateUpdate(),this.onSceneChange()):console.warn("Scene "+a+" is not exist.")},a.fetchNextScene=function(){var a=this,c=this.game.stage.children.find(function(b){return b===a.currentScene.stage});if(c)this.currentScene.onShow();else{var d=this.currentScene.beforeCreate(),e=d instanceof Promise;e&&(this.beforeCreated=!1,d.then(function(){a.beforeCreated=!0,!0===a.isLoaded&&a.currentScene.create()}).catch(function(){return a.currentScene.create()})),this.currentScene.stage.visible=!0,this.game.stage.addChild(this.currentScene.stage);var f=function(){a.isLoaded=!0,a.currentScene.onLoaded(b.Loader.shared.resources);var c=!e||e&&a.beforeCreated;c&&a.currentScene.create(),a.currentScene.onShow()};this.game.useExternalLoader?(this.game.on(this.game.EVENT_NAMES.LOADED,function(){return f()}),this.game.on(this.game.EVENT_NAMES.LOADING,function(b,c,d){a.currentScene.onLoading(c,b,d)})):(r.Load(function(){return f()}),r.onLoading(function(b,c,d){return a.currentScene.onLoading(b,c,d)})),this.pendingSceneName=""}},a.onSceneChange=function(){var a=this.scenes[this.prevSceneName];a&&(a.cleanStage?(a.destory(),this.game.stage.removeChild(a.stage)):a.onHide())},a.stateUpdate=function(){this.prevSceneName=this.currentSceneName,this.currentSceneName=this.currentScene.name},a.isScene=function(a){return void 0===a&&(a=""),void 0!==this.scenes[a]},a.scenes={},a.query={},a.history=[],a.beforeCreated=!1,a.isLoaded=!1,a}();b.Ticker.shared.add(function(){return s.update()});var t=/** @class */function(){function a(){}return Object.defineProperty(a,"width",{get:function(){return window.innerWidth},enumerable:!0,configurable:!0}),Object.defineProperty(a,"height",{get:function(){return window.innerHeight},enumerable:!0,configurable:!0}),a}(),u={},v=/** @class */function(a){function b(b){var c=a.call(this)||this;return c.name=b,c.isStage=!0,c.sortableChildren=!0,c.init(),c}return d(b,a),b.prototype.init=function(){this.x=0,this.y=0,this.setSize()},b.prototype.setSize=function(){this.beginFill(16777215,0),this.drawRect(0,0,t.width,t.height),this.endFill()},b.prototype.onSceneChange=function(){this.init()},b.prototype.destory=function(){i(this)},b}(b.Graphics),w=/** @class */function(){function a(a){this.Loader=q,this.name=a,this.canUpdate=!1,this.ratios=this.game.PIXEL_RATIOS,this.stage=new v(a),s.push(this)}return Object.defineProperty(a.prototype,"ratio",{get:function(){return this.game.PIXEL_RATIO},enumerable:!0,configurable:!0}),a.prototype.Load=function(){r.Load()},a.prototype.onLoading=function(){},a.prototype.onLoaded=function(){},a.prototype.beforeCreate=function(){return e(this,void 0,void 0,function(){return f(this,function(){return[2/*return*/]})})},a.prototype.create=function(){},a.prototype.onShow=function(){},a.prototype.onHide=function(){},a.prototype.switchTo=function(a,b){void 0===b&&(b={}),s.to(a,b)},a.prototype.getQuery=function(a){return s.getQuery(a)},a.prototype.useUpdate=function(){this.canUpdate=!0},a.prototype.update=function(){!this.canUpdate},a.prototype.destory=function(){this.canUpdate=!1,this.stage.destory()},a}(),x=/** @class */function(a){function b(){var b=a.call(this)||this;return b.game=k(),b.stage=l(),b.stage.addChild(b),b.ratios=b.game.PIXEL_RATIOS,b}return d(b,a),Object.defineProperty(b.prototype,"ratio",{get:function(){return this.game.PIXEL_RATIO},enumerable:!0,configurable:!0}),b}(b.Container),y=/** @class */function(a){function b(b,c,d,e,f,g,h){void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=t.width),void 0===e&&(e=t.height),void 0===f&&(f=0),void 0===g&&(g=16777215),void 0===h&&(h=0);var i=a.call(this)||this;return i.game=k(),i.stage=l(),i.color=16777215,i.opacity=0,i.frame={x:0,y:0,width:0,height:0,radius:0},i.stage.addChild(i),i.ratios=i.game.PIXEL_RATIOS,i.color=g,i.opacity=h,i.frame={x:b,y:c,width:d,height:e,radius:f},i.beginFill(i.color,i.opacity),i.drawRoundedRect(b,c,d,e,f),i.endFill(),i}return d(b,a),Object.defineProperty(b.prototype,"ratio",{get:function(){return this.game.PIXEL_RATIO},enumerable:!0,configurable:!0}),b.prototype.setSize=function(a,b,c){void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=this.frame.radius),this.clear(),this.frame.width=a,this.frame.height=b,this.frame.radius=c;var d=this.frame,e=d.x,f=d.y;this.beginFill(this.color,this.opacity),this.drawRoundedRect(e,f,a,b,c),this.endFill()},b}(b.Graphics),z=/** @class */function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return d(b,a),b}(b.Application),A=new c,B={backgroundColor:0,autoResize:!0,width:t.width,height:t.height,UIWidth:t.width,UIHeight:t.height,resolution:devicePixelRatio};m([function(a){a.on("created",function(b){var c=b.game;c.on=function(b,c,d){a.on(b,c,d)},c.emit=function(b){for(var c=[],d=1;d<arguments.length;d++)c[d-1]=arguments[d];a.emit.apply(a,g([b],c))},c.eventNames=function(){return a.eventNames()}})},function(a){a.on("created",function(a){var b=a.PIXI,c=a.configure,d=a.game;d.Loader=b.Loader,d.resources=b.Loader.shared.resources,d.EVENT_NAMES={},d.EVENT_NAMES.LOADED="LOADED",d.EVENT_NAMES.LOADING="LOADING",c.view.setAttribute("resolution",""+c.resolution),w.prototype.game=d;var e=c.UIWidth,f=c.UIHeight;// 竖屏应用，以宽为准；横屏应用，以高为准
d.PIXEL_RATIOS={get x(){var a=j()?d.view.width:d.view.height;return a/c.resolution/e},get y(){var a=j()?d.view.height:d.view.width;return a/c.resolution/f}},Object.defineProperty(d,"PIXEL_RATIO",{get:function(){return e<f?d.PIXEL_RATIOS.x:d.PIXEL_RATIOS.y}}),u.PIXEL_RATIOS=d.PIXEL_RATIOS})},function(a){a.on("sceneCreate",function(a){var b=a.game,c=a.configure,d=Object.keys(c.scenes).map(function(a){return a.toLowerCase()}),e=Object.values(c.scenes);e.map(function(a,b){return new a(d[b])}),s.game=b,s.to(d[0])})}]),window.PIXI=b,a.Component=x,a.Resource=r,a.ResourceLoader=q,a.Route=s,a.Scene=w,a.SizeComponent=y,a.createGame=n,a.event=A,a.getGame=k,a.getStage=l,a.getType=function(a){return a.text?"Text":a.fill?"Graphics":a.animationSpeed?"AnimatedSprite":a.isSprite?"Sprite":"Container"},a.shared=u,a.use=m,Object.defineProperty(a,"__esModule",{value:!0})});
//# sourceMappingURL=index.min.js.map
