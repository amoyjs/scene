(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports,require("pixi.js")):"function"==typeof define&&define.amd?define(["exports","pixi.js"],b):(a=a||self,b(a.SceneKit={},a.PIXI))})(this,function(a,b){'use strict';function c(a,c){function b(){this.constructor=a}m(a,c),a.prototype=null===c?Object.create(c):(b.prototype=c.prototype,new b)}function d(){if("undefined"!=typeof canvas)return canvas;var a=document.createElement("canvas");return document.body.appendChild(a),a}function e(a){a.children.map(function(a){return e(a)}),a.removeChildren()}function f(){return q.prototype.game}function g(){return f().stage.children.find(function(a){return a.name===j.currentScene.name})}function h(a,c){var d=Object.keys(c).map(function(a){return a.toLowerCase()}),e=Object.values(c);t.map(function(c){return c(b,{game:a,Scene:q,Resource:l,ResourceLoader:k,Stage:p,Route:j})}),e.map(function(a,b){return new a(d[b])});var f=j.create(a),g=d[0];f.to(g),a.ticker.add(function(){return f.update()})}function i(a,b){var c=a.Loader,d=b.game;d.Loader=c,d.resources=c.shared.resources,q.prototype.game=d;var e=d.configure,f=e.UIWidth,g=e.UIHeight,h=d.view.width/d.configure.resolution,i=d.view.height/d.configure.resolution;// 竖屏应用，以宽为准；横屏应用，以高为准
d.PIXEL_RATIO=o.PIXEL_RATIO=f<g?h/f:i/g,d.PIXEL_RATIOS=o.PIXEL_RATIOS={x:h/f,y:i/g}}var j=/** @class */function(){function a(b){a.game=b}return a.create=function(b){return this.instance||(this.instance=new a(b)),this.instance},a.push=function(b){a.scenes[b.name]=b},a.to=function(b,c){return void 0===c&&(c={}),a.currentSceneName!==b&&void(this.isScene(b)&&(a.pendingSceneName=b,this.query=c))},a.prototype.to=function(b,c){return void 0===c&&(c={}),a.currentSceneName!==b&&void(a.isScene(b)&&(a.pendingSceneName=b,a.query=c))},a.prototype.update=function(){a.pendingSceneName&&this.setCurrentScene(a.pendingSceneName),a.currentScene&&a.currentScene.canUpdate&&a.currentScene.update&&a.currentScene.update()},a.prototype.setCurrentScene=function(b){return a.isScene(b)?void(a.currentSceneName!==a.pendingSceneName&&(a.currentScene=a.scenes[b],this.cleanStage(),this.fetchNextScene(),this.stateUpdate(),this.onSceneChange())):(console.warn("\u573A\u666F "+b+" \u4E0D\u5B58\u5728"),!1)},a.prototype.cleanStage=function(){a.game.stage.removeChildren()},a.prototype.fetchNextScene=function(){a.game.stage.addChild(a.currentScene.stage),a.currentScene.Load(),b.Loader.shared.load(function(){return a.currentScene.autoCreate&&a.currentScene.create()}),b.Loader.shared.on("progress",function(b,c){return a.currentScene.onLoading(b.progress,c.name,c.url)}),a.pendingSceneName=null},a.prototype.stateUpdate=function(){a.prevSceneName=a.currentSceneName,a.currentSceneName=a.currentScene.name},a.prototype.onSceneChange=function(){if(a.prevSceneName){var b=a.scenes[a.prevSceneName];b.destory(),a.game.stage.removeChild(b.stage)}a.currentScene.stage.onSceneChange()},a.isScene=function(b){void 0===b&&(b="");var c=void 0!==a.scenes[b];return c},a.scenes={},a.query={},a}(),k={add:function(){for(var a,c=[],d=0;d<arguments.length;d++)c[d]=arguments[d];b.Loader.shared.resources[c[0]]||(a=b.Loader.shared).add.apply(a,c)},Load:function(a){var b=this;Object.keys(a).map(function(c){return b.add(c,a[c])})},onLoaded:function(a){void 0===a&&(a=function(){}),b.Loader.shared.load(function(){return a(b.Loader.shared.resources)})}},l=/** @class */function(){function a(){}return a.use=function(a){this.resourceGetters.push(a)},a.useLoad=function(a){this.resourceGetters.push(a),console.warn("'Resource.useLoad()' will be deprecated in next major version, use 'Resource.use()' to instead.")},a.getLoad=function(){var a=this.resourceGetters.filter(function(a){return"object"==typeof a}).reduce(function(a,b){return Object.assign(a,b)},{}),b=this.resourceGetters.filter(function(a){return"function"==typeof a}).reduce(function(a,b){return Object.assign(a,b())},{});return Object.assign(a,b)},a.Load=function(a){void 0===a&&(a=function(){}),k.Load(this.getLoad()),this.resourceGetters=[],b.Loader.shared.load(function(){return a(b.Loader.shared.resources)})},a.onLoading=function(a){void 0===a&&(a=function(){}),b.Loader.shared.on("progress",function(b,c){return a(b.progress,c.name,c.url)})},a.resourceGetters=[],a}(),m=function(a,c){return m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,c){a.__proto__=c}||function(a,c){for(var b in c)c.hasOwnProperty(b)&&(a[b]=c[b])},m(a,c)},n=/** @class */function(){function a(){}return Object.defineProperty(a,"width",{get:function(){return window.innerWidth},enumerable:!0,configurable:!0}),Object.defineProperty(a,"height",{get:function(){return window.innerHeight},enumerable:!0,configurable:!0}),a}(),o={},p=/** @class */function(a){function b(b){var c=a.call(this)||this;return c.name=b,c.isStage=!0,c.sortableChildren=!0,c.init(),c}return c(b,a),b.prototype.init=function(){this.x=0,this.y=0,this.setSize()},b.prototype.setSize=function(){this.beginFill(16777215,0),this.drawRect(0,0,n.width,n.height),this.endFill()},b.prototype.onSceneChange=function(){this.init()},b.prototype.destory=function(){e(this)},b}(b.Graphics),q=/** @class */function(){function a(a){this.Loader=k,this.autoCreate=!0,this.name=a,this.canUpdate=!1,this.ratio=this.game.PIXEL_RATIO,this.ratios=this.game.PIXEL_RATIOS,this.stage=new p(a),j.push(this)}return a.use=function(a){var b=this;if(Array.isArray(a))a.map(function(a){return b.use(a)});else if("function"==typeof a)this.addons.push(a);else throw Error("Scene.use() expected a function.")},a.prototype.Load=function(){l.Load()},a.prototype.onLoading=function(){},a.useLoad=function(a){console.warn("Scene.useLoad() will be deprecated, please update to version \"@amoy/scene@0.4.34\" or later and use \"Resource.useLoad()\" to instead."),l.useLoad(a)},a.prototype.switchTo=function(a,b){void 0===b&&(b={}),j.to(a,b)},a.prototype.getQuery=function(a){return a?j.query[a]:j.query},a.prototype.create=function(){},a.prototype.useUpdate=function(){this.canUpdate=!0},a.prototype.update=function(){if(!this.canUpdate)return!1},a.prototype.destory=function(){this.canUpdate=!1,this.stage.destory()},a.addons=[],a}(),r=/** @class */function(a){function b(){var b=a.call(this)||this;return b.game=f(),b.stage=g(),b.stage.addChild(b),b.ratio=b.game.PIXEL_RATIO,b.ratios=b.game.PIXEL_RATIOS,b}return c(b,a),b}(b.Container),s=/** @class */function(a){function b(b,c,d,e,h,i,j){void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=n.width),void 0===e&&(e=n.height),void 0===h&&(h=0),void 0===i&&(i=16777215),void 0===j&&(j=0);var k=a.call(this)||this;return k.game=f(),k.stage=g(),k.color=16777215,k.opacity=0,k.frame={x:0,y:0,width:0,height:0,radius:0},k.stage.addChild(k),k.ratio=k.game.PIXEL_RATIO,k.ratios=k.game.PIXEL_RATIOS,k.color=i,k.opacity=j,k.frame={x:b,y:c,width:d,height:e,radius:h},k.beginFill(k.color,k.opacity),k.drawRoundedRect(b,c,d,e,h),k.endFill(),k}return c(b,a),b.prototype.setSize=function(a,b,c){void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=this.frame.radius),this.clear(),this.frame.width=a,this.frame.height=b,this.frame.radius=c;var d=this.frame,e=d.x,f=d.y;this.beginFill(this.color,this.opacity),this.drawRoundedRect(e,f,a,b,c),this.endFill()},b}(b.Graphics),t=[],u={backgroundColor:0,autoResize:!0,width:n.width,height:n.height,UIWidth:n.width,UIHeight:n.height,resolution:devicePixelRatio},v=b.Application;window.PIXI=b,a.Component=r,a.Resource=l,a.ResourceLoader=k,a.Route=j,a.Scene=q,a.SizeComponent=s,a.createGame=function(a){var c=a.view;a=Object.assign(u,a),a.width=n.width,a.height=n.height,a.view=c||d(),t.map(function(a){return a(b,{Scene:q,Resource:l,ResourceLoader:k,Stage:p,Route:j,Component:r})});var e=new v(a);return e.configure=a,i(b,{game:e}),h(e,a.scenes),e},a.createScene=h,a.getGame=f,a.getStage=g,a.shared=o,a.use=function(a){Array.isArray(a)?a.map(function(a){return t.push(a)}):"function"==typeof a?t.push(a):console.error("extendsion "+a+" must be a function")},Object.defineProperty(a,"__esModule",{value:!0})});
//# sourceMappingURL=scene.min.js.map
