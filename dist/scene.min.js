(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports,require("pixi.js")):"function"==typeof define&&define.amd?define(["exports","pixi.js"],b):(a=a||self,b(a.SceneKit={},a.PIXI))})(this,function(a,b){'use strict';function c(a,c){function b(){this.constructor=a}k(a,c),a.prototype=null===c?Object.create(c):(b.prototype=c.prototype,new b)}/*!
     * @pixi/unsafe-eval - v5.0.4
     * Compiled Fri, 07 Jun 2019 17:17:49 UTC
     *
     * @pixi/unsafe-eval is licensed under the MIT License.
     * http://www.opensource.org/licenses/mit-license
     */ // cv = CachedValue
// v = value
// ud = uniformData
// uv = uniformValue
// l = location
/* eslint-disable max-len */ /* eslint-disable max-len */function d(a,b,c,d,e){var f=0,g=null,h=null,j=e.gl;for(var k in a.uniforms){var i=b[k],n=d[k],o=c[k],p=a.uniforms[k];if(!i){p.group&&e.shader.syncUniformGroup(n);continue}if("float"===i.type&&1===i.size)n!==o.value&&(o.value=n,j.uniform1f(o.location,n));/* eslint-disable max-len */else if(("sampler2D"===i.type||"samplerCube"===i.type||"sampler2DArray"===i.type)&&1===i.size&&!i.isArray)/* eslint-disable max-len */e.texture.bind(n,f),o.value!==f&&(o.value=f,j.uniform1i(o.location,f)),f++;else if("mat3"===i.type&&1===i.size)void 0===p.a?j.uniformMatrix3fv(o.location,!1,n):j.uniformMatrix3fv(o.location,!1,n.toArray(!0));else if("vec2"===i.type&&1===i.size)void 0===p.x?(h=o.value,g=n,(h[0]!==g[0]||h[1]!==g[1])&&(h[0]=g[0],h[1]=g[1],j.uniform2f(o.location,g[0],g[1]))):(h=o.value,g=n,(h[0]!==g.x||h[1]!==g.y)&&(h[0]=g.x,h[1]=g.y,j.uniform2f(o.location,g.x,g.y)));else if("vec4"===i.type&&1===i.size)void 0===p.width?(h=o.value,g=n,(h[0]!==g[0]||h[1]!==g[1]||h[2]!==g[2]||h[3]!==g[3])&&(h[0]=g[0],h[1]=g[1],h[2]=g[2],h[3]=g[3],j.uniform4f(o.location,g[0],g[1],g[2],g[3]))):(h=o.value,g=n,(h[0]!==g.x||h[1]!==g.y||h[2]!==g.width||h[3]!==g.height)&&(h[0]=g.x,h[1]=g.y,h[2]=g.width,h[3]=g.height,j.uniform4f(o.location,g.x,g.y,g.width,g.height)));else{var q=1===i.size?l:m;q[i.type].call(null,j,o.location,o.value,n)}}}function e(a){if(!a||!a.systems||!a.systems.ShaderSystem)throw new Error("Unable to patch ShaderSystem, class not found.");var b=a.systems,c=b.ShaderSystem,e=!1;// Do a quick check to see if the patch is needed
// want to make sure we only apply if necessary!
try{c.prototype.systemCheck.call(null),e=!1}catch(a){e=!0}// Only apply if needed
e&&Object.assign(c.prototype,{systemCheck:function(){// do nothing, don't throw error
},syncUniforms:function(a,b){var c=this,e=c.shader,f=c.renderer;/* eslint-disable max-len */d(a,e.program.uniformData,b.uniformData,a.uniforms,f)}})}function f(){if("undefined"!=typeof canvas)return canvas;var a=document.createElement("canvas");return document.body.appendChild(a),a}function g(a){a.children.map(function(a){return g(a)}),a.removeChildren()}function h(a,b){var c=Object.keys(b).map(function(a){return a.toLowerCase()}),d=Object.values(b);j.prototype.game=a,d.map(function(a,b){return new a(c[b])});var e=i.create(a);e.to(c[0]),a.ticker.add(function(){return e.update()})}var i=/** @class */function(){function a(a){this.game=a,this.scenes={},this.query={}}return a.create=function(b){return this.instance||(this.instance=new a(b)),this.instance},a.prototype.push=function(a){this.scenes[a.name]=a},a.prototype.to=function(a,b){return void 0===b&&(b={}),this.currentSceneName!==a&&void(this.isScene(a)&&(this.pendingSceneName=a,this.query=b))},a.prototype.update=function(){this.pendingSceneName&&this.setCurrentScene(this.pendingSceneName),this.currentScene&&this.currentScene.canUpdate&&this.currentScene.update&&this.currentScene.update()},a.prototype.setCurrentScene=function(a){return this.isScene(a)?void(this.currentSceneName!==this.pendingSceneName&&(this.currentScene=this.scenes[a],this.cleanStage(),this.fetchNextScene(),this.stateUpdate(),this.onSceneChange())):(console.warn("\u573A\u666F "+a+" \u4E0D\u5B58\u5728"),!1)},a.prototype.cleanStage=function(){this.game.stage.removeChildren()},a.prototype.fetchNextScene=function(){var a=this;this.game.stage.addChild(this.currentScene.stage),this.currentScene.Load(),b.Loader.shared.load(function(){return a.currentScene.create()}),b.Loader.shared.on("progress",function(b,c){return a.currentScene.onLoading(b.progress,c.name,c.url)}),this.pendingSceneName=null},a.prototype.stateUpdate=function(){this.prevSceneName=this.currentSceneName,this.currentSceneName=this.currentScene.name},a.prototype.onSceneChange=function(){if(this.prevSceneName){var a=this.scenes[this.prevSceneName];a.shutdown(),this.game.stage.removeChild(a.stage)}this.currentScene.stage.onSceneChange()},a.prototype.isScene=function(a){void 0===a&&(a="");var b=void 0!==this.scenes[a];return b},a.prototype.destroy=function(){this.game=null,this.scenes={},this.pendingSceneName=null,this.currentSceneName=null,this.currentScene=null},a}(),j=/** @class */function(){function a(b){var c=this;this.name=b,this.canUpdate=!1,this.ratio=this.game.PIXEL_RATIO.x,this.ratios=this.game.PIXEL_RATIO,a.addons.map(function(a){return a.call(c)})}return a.use=function(a){var b=this;Array.isArray(a)?a.map(function(a){return b.use(a)}):this.addons.push(a)},Object.defineProperty(a.prototype,"Loader",{get:function(){return{add:function(){for(var a,c=[],d=0;d<arguments.length;d++)c[d]=arguments[d];b.Loader.shared.resources[c[0]]||(a=b.Loader.shared).add.apply(a,c)},Load:function(a){var b=this;Object.keys(a).map(function(c){return b.add(c,a[c])})},onLoaded:function(a){void 0===a&&(a=function(){}),b.Loader.shared.load(function(){return a()})}}},enumerable:!0,configurable:!0}),a.prototype.Load=function(){this.Loader.Load(this.getLoad())},a.prototype.getLoad=function(){return a.resourceGetters.reduce(function(a,b){return a=Object.assign(a,b()),a},{})},a.useLoad=function(a){this.resourceGetters.push(a)},a.prototype.switchTo=function(a,b){void 0===b&&(b={}),this.route.to(a,b)},a.prototype.getQuery=function(a){return a?this.route.query[a]:this.route.query},a.prototype.create=function(){},a.prototype.onLoading=function(){},a.prototype.useUpdate=function(){this.canUpdate=!0},a.prototype.update=function(){if(!this.canUpdate)return!1},a.prototype.shutdown=function(a){void 0===a&&(a=!0),this.canUpdate=!1,a&&this.stage.shutdown()},a.addons=[],a.resourceGetters=[],a}(),k=function(a,c){return k=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,c){a.__proto__=c}||function(a,c){for(var b in c)c.hasOwnProperty(b)&&(a[b]=c[b])},k(a,c)},l={float:function(a,b,c,d){c!==d&&(c.v=d,a.uniform1f(b,d))},vec2:function(a,b,c,d){(c[0]!==d[0]||c[1]!==d[1])&&(c[0]=d[0],c[1]=d[1],a.uniform2f(b,d[0],d[1]))},vec3:function(a,b,c,d){(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2])&&(c[0]=d[0],c[1]=d[1],c[2]=d[2],a.uniform3f(b,d[0],d[1],d[2]))},int:function(a,b,c,d){a.uniform1i(b,d)},ivec2:function(a,b,c,d){a.uniform2i(b,d[0],d[1])},ivec3:function(a,b,c,d){a.uniform3i(b,d[0],d[1],d[2])},ivec4:function(a,b,c,d){a.uniform4i(b,d[0],d[1],d[2],d[3])},bool:function(a,b,c,d){a.uniform1i(b,d)},bvec2:function(a,b,c,d){a.uniform2i(b,d[0],d[1])},bvec3:function(a,b,c,d){a.uniform3i(b,d[0],d[1],d[2])},bvec4:function(a,b,c,d){a.uniform4i(b,d[0],d[1],d[2],d[3])},mat2:function(a,b,c,d){a.uniformMatrix2fv(b,!1,d)},mat3:function(a,b,c,d){a.uniformMatrix3fv(b,!1,d)},mat4:function(a,b,c,d){a.uniformMatrix4fv(b,!1,d)},sampler2D:function(a,b,c,d){a.uniform1i(b,d)},samplerCube:function(a,b,c,d){a.uniform1i(b,d)},sampler2DArray:function(a,b,c,d){a.uniform1i(b,d)}},m={float:function(a,b,c,d){a.uniform1fv(b,d)},vec2:function(a,b,c,d){a.uniform2fv(b,d)},vec3:function(a,b,c,d){a.uniform3fv(b,d)},vec4:function(a,b,c,d){a.uniform4fv(b,d)},int:function(a,b,c,d){a.uniform1iv(b,d)},ivec2:function(a,b,c,d){a.uniform2iv(b,d)},ivec3:function(a,b,c,d){a.uniform3iv(b,d)},ivec4:function(a,b,c,d){a.uniform4iv(b,d)},bool:function(a,b,c,d){a.uniform1iv(b,d)},bvec2:function(a,b,c,d){a.uniform2iv(b,d)},bvec3:function(a,b,c,d){a.uniform3iv(b,d)},bvec4:function(a,b,c,d){a.uniform4iv(b,d)},sampler2D:function(a,b,c,d){a.uniform1iv(b,d)},samplerCube:function(a,b,c,d){a.uniform1iv(b,d)},sampler2DArray:function(a,b,c,d){a.uniform1iv(b,d)}},n=/** @class */function(a){function b(b){var c=a.call(this)||this;return c.game=b,c.isStage=!0,c.init(),c}return c(b,a),b.prototype.init=function(){this.x=0,this.y=0,this.setSize()},b.prototype.setSize=function(){this.beginFill(16777215,0),this.drawRect(0,0,this.game.view.width,this.game.view.height),this.endFill()},b.prototype.onSceneChange=function(){this.init()},b.prototype.shutdown=function(){g(this)},b}(b.Graphics);j.use(function(){this.stage=new n(this.game),this.route=i.create(this.game),this.route.push(this)});var o={backgroundColor:0,autoResize:!0,width:window.innerWidth,height:window.innerHeight},p=/** @class */function(a){function b(){var b=a.call(this)||this;return b.game=j.prototype.game,b.stage=b.game.stage,b.stage.addChild(b),b.ratio=b.game.PIXEL_RATIO.x,b.ratios=b.game.PIXEL_RATIO,b}return c(b,a),b}(b.Container),q=function(a){return function b(c){Array.isArray(c)?c.map(function(a){return b(a)}):"function"==typeof c?c(a):console.error("addon "+c+" must be a function")}}(b);(function(){// @ts-ignore
"function"!=typeof eval&&e(b),b.Renderer.create=function(a){return new b.Renderer(a)}})(),window.PIXI=b,a.Component=p,a.Scene=j,a.createGame=function(a){var c=a.view;a=Object.assign(o,a);var d=a.UIWidth,e=a.UIHeight,g=a.width,i=a.height,j=a.scenes;a.view=c||f();var k=new b.Application(a);return k.Loader=b.Loader,k.resources=b.Loader.shared.resources,d&&e?(k.UI_DESIGN_RATIO=g/d,k.PIXEL_RATIO={x:g/d,y:i/e}):console.warn("must specified both \"options.UIWidth\" and \"options.UIHeight\" in createGame(options), or you can not use \"game.PIXEL_RATIO\" correctly."),h(k,j),k},a.use=q,a.useScene=h,Object.defineProperty(a,"__esModule",{value:!0})});
//# sourceMappingURL=scene.min.js.map
