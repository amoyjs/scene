(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports,require("pixi.js"),require("eventemitter3")):"function"==typeof define&&define.amd?define(["exports","pixi.js","eventemitter3"],b):(a=a||self,b(a.SceneKit={},a.PIXI,a.EventEmitter))})(this,function(a,b,c){'use strict';function d(a,c){function b(){this.constructor=a}m(a,c),a.prototype=null===c?Object.create(c):(b.prototype=c.prototype,new b)}function e(a,b,c,d){return new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d["throw"](a))}catch(a){f(a)}}function i(a){a.done?e(a.value):new c(function(b){b(a.value)}).then(g,h)}i((d=d.apply(a,b||[])).next())})}function f(a,b){function c(a){return function(b){return d([a,b])}}function d(c){if(e)throw new TypeError("Generator is already executing.");for(;k;)try{if(e=1,h&&(i=2&c[0]?h["return"]:c[0]?h["throw"]||((i=h["return"])&&i.call(h),0):h.next)&&!(i=i.call(h,c[1])).done)return i;switch((h=0,i)&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return k.label++,{value:c[1],done:!1};case 5:k.label++,h=c[1],c=[0];continue;case 7:c=k.ops.pop(),k.trys.pop();continue;default:if((i=k.trys,!(i=0<i.length&&i[i.length-1]))&&(6===c[0]||2===c[0])){k=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){k.label=c[1];break}if(6===c[0]&&k.label<i[1]){k.label=i[1],i=c;break}if(i&&k.label<i[2]){k.label=i[2],k.ops.push(c);break}i[2]&&k.ops.pop(),k.trys.pop();continue;}c=b.call(a,k)}catch(a){c=[6,a],h=0}finally{e=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}var e,h,i,j,k={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return j={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(j[Symbol.iterator]=function(){return this}),j}function g(){if("undefined"!=typeof canvas)return canvas;var a=document.createElement("canvas");return document.body.appendChild(a),a}function h(a){a.children.map(function(a){return h(a)}),a.removeChildren()}function i(){return u.prototype.game}function j(){return i().stage.children.find(function(a){return a.name===q.currentScene.name})}function k(a,b){var c=Object.keys(b).map(function(a){return a.toLowerCase()}),d=Object.values(b);x.emit("created",{game:a}),d.map(function(a,b){return new a(c[b])}),q.game=a,q.to(c[0])}function l(a,b){var c=a.Loader,d=b.game;d.Loader=c,d.resources=c.shared.resources,u.prototype.game=d;var e=d.configure,f=e.UIWidth,g=e.UIHeight,h=d.view.width/d.configure.resolution,i=d.view.height/d.configure.resolution;d.PIXEL_RATIOS=s.PIXEL_RATIOS={x:h/f,y:i/g},Object.defineProperty(d,"PIXEL_RATIO",{get:function(){return f<g?d.PIXEL_RATIOS.x:d.PIXEL_RATIOS.y}})}c=c&&Object.prototype.hasOwnProperty.call(c,"default")?c["default"]:c;/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */ /* global Reflect, Promise */var m=function(a,c){return m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,c){a.__proto__=c}||function(a,c){for(var b in c)c.hasOwnProperty(b)&&(a[b]=c[b])},m(a,c)},n=function(){return n=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++)for(var e in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e]);return a},n.apply(this,arguments)},o={add:function(){for(var a,c=[],d=0;d<arguments.length;d++)c[d]=arguments[d];b.Loader.shared.resources[c[0]]||(a=b.Loader.shared).add.apply(a,c)},Load:function(a,b){var c=this;Object.keys(a).map(function(d){var e=/\.(svg|png|gif|jpe?g)/.test(a[d]),f=/\.(json)/.test(a[d])||Array.isArray(a[d]),g=[d,a[d]],h=n({},b);if(Array.isArray(a[d])){var i=a[d].find(function(a){return /\.(svg|png|gif|jpe?g)/.test(a)}),j=a[d].find(function(a){return /\.(json)/.test(a)});i&&j&&(g[1]=j,h.metadata={jsonImage:i})}(e||f)&&g.push(h),c.add.apply(c,g)})},onLoaded:function(a){void 0===a&&(a=function(){}),b.Loader.shared.load(function(){return a(b.Loader.shared.resources)})}},p=function(){function a(){}return a.use=function(a){this.resourceGetters.push(a)},a.useLoad=function(a){this.resourceGetters.push(a),console.warn("'Resource.useLoad()' will be deprecated in next major version, use 'Resource.use()' to instead.")},a.getLoad=function(){var a=this.resourceGetters.filter(function(a){return"object"==typeof a}).reduce(function(a,b){return Object.assign(a,b)},{}),b=this.resourceGetters.filter(function(a){return"function"==typeof a}).reduce(function(a,b){return Object.assign(a,b())},{});return Object.assign(a,b)},a.optionSetting=function(a){this.options=a},a.Load=function(a){return void 0===a&&(a=function(){}),e(this,void 0,void 0,function(){var c=this;return f(this,function(){return o.Load(this.getLoad(),this.options),this.resourceGetters=[],this.state="Loading",[2,new Promise(function(d){return b.Loader.shared.load(function(){c.state="Loaded",d(b.Loader.shared.resources),a(b.Loader.shared.resources),c._onLoaded(b.Loader.shared.resources)})})]})})},a.onLoading=function(a){void 0===a&&(a=function(){}),b.Loader.shared.on("progress",function(b,c){return a(b.progress,c.name,c.url)})},a.onLoaded=function(a){void 0===a&&(a=function(){}),this._onLoaded=a},a._onLoaded=function(){},a.state="Loading",a.resourceGetters=[],a}(),q=function(){function a(){}return a.push=function(a){this.scenes[a.name]=a},a.to=function(a,b){void 0===b&&(b={}),this.isScene(a)&&this.currentSceneName!==a&&(this.pendingSceneName=a,this.query=b,this.history.push(a),this.setCurrentScene(this.pendingSceneName))},a.back=function(a){void 0===a&&(a={}),1>=this.history.length||(this.history.pop(),this.to(this.history.pop(),a))},a.getQuery=function(a){return a?this.query[a]:this.query},a.update=function(){this.currentScene&&this.currentScene.canUpdate&&this.currentScene.update()},a.setCurrentScene=function(a){return this.isScene(a)?void(this.game.stage.children.map(function(a){return a.visible=!1}),this.currentScene=this.scenes[a],this.currentScene.stage.visible=!0,this.fetchNextScene(),this.stateUpdate(),this.onSceneChange()):console.warn("Scene "+a+" is not exist.")},a.fetchNextScene=function(){var a=this,c=this.game.stage.children.find(function(b){return b===a.currentScene.stage});if(c)this.currentScene.onShow();else{var d=this.currentScene.beforeCreate(),e=d instanceof Promise;e&&(this.beforeCreated=!1,d.then(function(){a.beforeCreated=!0,"Loaded"===p.state&&a.currentScene.create()})),this.currentScene.stage.visible=!0,this.game.stage.addChild(this.currentScene.stage),p.Load(function(){a.currentScene.onLoaded(b.Loader.shared.resources);var c=!e||e&&a.beforeCreated;c&&a.currentScene.create(),a.currentScene.onShow()}),p.onLoading(function(b,c,d){return a.currentScene.onLoading(b,c,d)}),this.pendingSceneName=""}},a.onSceneChange=function(){var a=this.scenes[this.prevSceneName];a&&(a.cleanStage?(a.destory(),this.game.stage.removeChild(a.stage)):a.onHide())},a.stateUpdate=function(){this.prevSceneName=this.currentSceneName,this.currentSceneName=this.currentScene.name},a.isScene=function(a){return void 0===a&&(a=""),void 0!==this.scenes[a]},a.scenes={},a.query={},a.history=[],a.beforeCreated=!1,a}();b.Ticker.shared.add(function(){return q.update()});var r=function(){function a(){}return Object.defineProperty(a,"width",{get:function(){return window.innerWidth},enumerable:!0,configurable:!0}),Object.defineProperty(a,"height",{get:function(){return window.innerHeight},enumerable:!0,configurable:!0}),a}(),s={},t=function(a){function b(b){var c=a.call(this)||this;return c.name=b,c.isStage=!0,c.sortableChildren=!0,c.init(),c}return d(b,a),b.prototype.init=function(){this.x=0,this.y=0,this.setSize()},b.prototype.setSize=function(){this.beginFill(16777215,0),this.drawRect(0,0,r.width,r.height),this.endFill()},b.prototype.onSceneChange=function(){this.init()},b.prototype.destory=function(){h(this)},b}(b.Graphics),u=function(){function a(a){this.Loader=o,this.name=a,this.canUpdate=!1,this.ratios=this.game.PIXEL_RATIOS,this.stage=new t(a),q.push(this)}return Object.defineProperty(a.prototype,"ratio",{get:function(){return this.game.PIXEL_RATIO},enumerable:!0,configurable:!0}),a.prototype.Load=function(){p.Load()},a.prototype.onLoading=function(){},a.prototype.onLoaded=function(){},a.prototype.beforeCreate=function(){},a.prototype.create=function(){},a.prototype.onShow=function(){},a.prototype.onHide=function(){},a.prototype.switchTo=function(a,b){void 0===b&&(b={}),q.to(a,b)},a.prototype.getQuery=function(a){return q.getQuery(a)},a.prototype.useUpdate=function(){this.canUpdate=!0},a.prototype.update=function(){!this.canUpdate},a.prototype.destory=function(){this.canUpdate=!1,this.stage.destory()},a}(),v=function(a){function b(){var b=a.call(this)||this;return b.game=i(),b.stage=j(),b.stage.addChild(b),b.ratios=b.game.PIXEL_RATIOS,b}return d(b,a),Object.defineProperty(b.prototype,"ratio",{get:function(){return this.game.PIXEL_RATIO},enumerable:!0,configurable:!0}),b}(b.Container),w=function(a){function b(b,c,d,e,f,g,h){void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=r.width),void 0===e&&(e=r.height),void 0===f&&(f=0),void 0===g&&(g=16777215),void 0===h&&(h=0);var k=a.call(this)||this;return k.game=i(),k.stage=j(),k.color=16777215,k.opacity=0,k.frame={x:0,y:0,width:0,height:0,radius:0},k.stage.addChild(k),k.ratios=k.game.PIXEL_RATIOS,k.color=g,k.opacity=h,k.frame={x:b,y:c,width:d,height:e,radius:f},k.beginFill(k.color,k.opacity),k.drawRoundedRect(b,c,d,e,f),k.endFill(),k}return d(b,a),Object.defineProperty(b.prototype,"ratio",{get:function(){return this.game.PIXEL_RATIO},enumerable:!0,configurable:!0}),b.prototype.setSize=function(a,b,c){void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=this.frame.radius),this.clear(),this.frame.width=a,this.frame.height=b,this.frame.radius=c;var d=this.frame,e=d.x,f=d.y;this.beginFill(this.color,this.opacity),this.drawRoundedRect(e,f,a,b,c),this.endFill()},b}(b.Graphics),x=new c,y={backgroundColor:0,autoResize:!0,width:r.width,height:r.height,UIWidth:r.width,UIHeight:r.height,resolution:devicePixelRatio};window.PIXI=b,a.Component=v,a.Resource=p,a.ResourceLoader=o,a.Route=q,a.Scene=u,a.SizeComponent=w,a.createGame=function(a){var c=a.view;a=Object.assign(y,a),a.view=c||g(),x.emit("beforeCreate",{PIXI:b,Scene:u,Resource:p,ResourceLoader:o,Stage:t,Route:q,Component:v});var d=new b.Application(a);return d.configure=a,l(b,{game:d}),k(d,a.scenes),d},a.createScene=k,a.event=x,a.getGame=i,a.getStage=j,a.getType=function(a){return a.text?"Text":a.fill?"Graphics":a.animationSpeed?"AnimatedSprite":a.isSprite?"Sprite":"Container"},a.shared=s,a.use=function(a){Array.isArray(a)?a.map(function(a){return a(x)}):"function"==typeof a?a(x):console.error("extendsion "+a+" must be a function")},Object.defineProperty(a,"__esModule",{value:!0})});
//# sourceMappingURL=scene.min.js.map
