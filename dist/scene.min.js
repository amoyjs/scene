(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports,require("pixi.js")):"function"==typeof define&&define.amd?define(["exports","pixi.js"],b):(a=a||self,b(a.SceneKit={},a.PIXI))})(this,function(a,b){'use strict';function c(a,c){function b(){this.constructor=a}h(a,c),a.prototype=null===c?Object.create(c):(b.prototype=c.prototype,new b)}function d(a,b){var c=Object.keys(b),d=Object.values(b);d.map(function(b,d){f.prototype.game=a,new b(c[d])});var e=g.create(a);e.start(c[0]),a.ticker.add(function(){return e.update()})}function e(a){return function b(c){Array.isArray(c)?c.map(function(a){return b(a)}):"function"==typeof c?c(a):console.error("addon "+c+" must be a function")}}var f=/** @class */function(){function a(b){var c=this;this.name=b,this.canUpdate=!1,this.ratio=this.game.PIXEL_RATIO.x,this.ratios=this.game.PIXEL_RATIO,a.addons.map(function(a){return a.call(c)})}return a.use=function(a){var b=this;Array.isArray(a)?a.map(function(a){return b.use(a)}):this.addons.push(a)},Object.defineProperty(a.prototype,"Loader",{get:function(){return{add:function(){for(var a,c=[],d=0;d<arguments.length;d++)c[d]=arguments[d];b.Loader.shared.resources[c[0]]||(a=b.Loader.shared).add.apply(a,c)},Load:function(a){var b=this;Object.keys(a).map(function(c){return b.add(c,a[c])})},onLoaded:function(a){void 0===a&&(a=function(){}),b.Loader.shared.load(function(){return a()})}}},enumerable:!0,configurable:!0}),a.prototype.getLoad=function(){return a.resourceGetters.reduce(function(a,b){return a=Object.assign(a,b()),a},{})},a.useLoad=function(a){this.resourceGetters.push(a)},a.prototype.switchTo=function(a,b){void 0===b&&(b={}),this.route.to(a,b)},a.prototype.getQuery=function(a){return a?this.route.query[a]:this.route.query},a.prototype.create=function(){// 
},a.prototype.useUpdate=function(){this.canUpdate=!0},a.prototype.update=function(){if(!this.canUpdate)return!1},a.prototype.shutdown=function(a){void 0===a&&(a=!0),this.canUpdate=!1,a&&this.stage.shutdown()},a.addons=[],a.resourceGetters=[],a}(),g=/** @class */function(){function a(a){this.game=a,this.scenes={},this.query={}}return a.create=function(b){return this.instance||(this.instance=new a(b)),this.instance},a.prototype.push=function(a){this.scenes[a.name]=a},a.prototype.remove=function(a){"string"==typeof a?delete this.scenes[a]:a instanceof f?delete this.scenes[a.name]:console.warn("\u9700\u8981\u79FB\u9664\u7684\u573A\u666F "+a+" \u4E0D\u5B58\u5728")},a.prototype.start=function(a,b){void 0===a&&(a=""),void 0===b&&(b={}),this.to(a,b)},a.prototype.to=function(a,b){return this.currentSceneName!==a&&void(this.isScene(a)&&(this.pendingSceneName=a,this.query=b))},a.prototype.update=function(){this.pendingSceneName&&this.setCurrentScene(this.pendingSceneName),this.currentScene&&this.currentScene.canUpdate&&this.currentScene.update&&this.currentScene.update()},a.prototype.setCurrentScene=function(a){return this.isScene(a)?void(this.currentSceneName!==this.pendingSceneName&&(this.currentScene=this.scenes[a],this.cleanStage(),this.fetchNextScene(),this.stateUpdate(),this.onSceneChange())):(console.warn("\u573A\u666F "+a+" \u4E0D\u5B58\u5728"),!1)},a.prototype.cleanStage=function(){this.game.stage.removeChildren()},a.prototype.fetchNextScene=function(){var a=this;this.game.stage.addChild(this.currentScene.stage),this.currentScene.Load&&"function"==typeof this.currentScene.Load?this.currentScene.Load(function(){return a.currentScene.create()}):this.currentScene.create(),this.currentScene.onLoading&&"function"==typeof this.currentScene.onLoading&&b.Loader.shared.on("progress",function(b,c){a.currentScene.onLoading(b.progress,c.name,c.url)}),this.pendingSceneName=null},a.prototype.stateUpdate=function(){this.prevSceneName=this.currentSceneName,this.currentSceneName=this.currentScene.name},a.prototype.onSceneChange=function(){if(this.prevSceneName){var a=this.scenes[this.prevSceneName];a.shutdown(),this.game.stage.removeChild(a.stage)}this.currentScene.stage.onSceneChange()},a.prototype.getCurrentScene=function(){return this.currentScene},a.prototype.getSceneByName=function(a){return this.scenes[a]?this.scenes[a]:void console.error("\u573A\u666F "+a+" \u4E0D\u5B58\u5728")},a.prototype.isScene=function(a){void 0===a&&(a="");var b=void 0!==this.scenes[a];return b},a.prototype.destroy=function(){this.game=null,this.scenes={},this.pendingSceneName=null,this.currentSceneName=null,this.currentScene=null},a}(),h=function(a,c){return h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,c){a.__proto__=c}||function(a,c){for(var b in c)c.hasOwnProperty(b)&&(a[b]=c[b])},h(a,c)},i=/** @class */function(a){function b(b){var c=a.call(this)||this;return c.init(),c.scene=b,c.isWorld=!0,c.isStage=!0,c}return c(b,a),b.prototype.init=function(){this.x=0,this.y=0},b.prototype.onSceneChange=function(){this.init()},b.prototype.shutdown=function(){this.removeChildren()},b}(b.Container);f.use(function(){this.stage=new i(this),this.route=g.create(this.game),this.route.push(this)});var j={view:function(){// @ts-ignore
if("undefined"!=typeof canvas)// @ts-ignore
return canvas;var a=document.createElement("canvas");return document.body.appendChild(a),a}(),backgroundColor:0,autoResize:!0,width:window.innerWidth,height:window.innerHeight};a.Scene=f,a.createGame=function(a){a=Object.assign(j,a);var c=a.UIWidth,e=a.UIHeight,f=a.width,g=a.height,h=a.scenes,i=a.beforeScene,k=a.afterScene,l=new b.Application(a);return l.renderer.resize(f,g),l.resources=b.Loader.shared.resources,l.Loader=b.Loader,c&&e?(l.UI_DESIGN_RATIO=f/c,l.PIXEL_RATIO={x:f/c,y:g/e}):console.warn("must specified both \"options.UIWidth\" and \"options.UIHeight\" in createGame(options), or you can not use \"game.PIXEL_RATIO\" correctly."),d(l,h),l},a.use=function(a){e(b)(a)},a.useScene=d,Object.defineProperty(a,"__esModule",{value:!0})});
//# sourceMappingURL=scene.min.js.map
