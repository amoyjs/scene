import*as PIXI from"pixi.js";import{Loader,Ticker,Graphics,Container,Application}from"pixi.js";/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */ /* global Reflect, Promise */var extendStatics=function(a,c){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,c){a.__proto__=c}||function(a,c){for(var b in c)c.hasOwnProperty(b)&&(a[b]=c[b])},extendStatics(a,c)};function __extends(a,c){function b(){this.constructor=a}extendStatics(a,c),a.prototype=null===c?Object.create(c):(b.prototype=c.prototype,new b)}var __assign=function(){return __assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++)for(var e in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e]);return a},__assign.apply(this,arguments)};function __awaiter(a,b,c,d){return new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d["throw"](a))}catch(a){f(a)}}function i(a){a.done?e(a.value):new c(function(b){b(a.value)}).then(g,h)}i((d=d.apply(a,b||[])).next())})}function __generator(a,b){function c(a){return function(b){return d([a,b])}}function d(c){if(e)throw new TypeError("Generator is already executing.");for(;k;)try{if(e=1,h&&(i=2&c[0]?h["return"]:c[0]?h["throw"]||((i=h["return"])&&i.call(h),0):h.next)&&!(i=i.call(h,c[1])).done)return i;switch((h=0,i)&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return k.label++,{value:c[1],done:!1};case 5:k.label++,h=c[1],c=[0];continue;case 7:c=k.ops.pop(),k.trys.pop();continue;default:if((i=k.trys,!(i=0<i.length&&i[i.length-1]))&&(6===c[0]||2===c[0])){k=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){k.label=c[1];break}if(6===c[0]&&k.label<i[1]){k.label=i[1],i=c;break}if(i&&k.label<i[2]){k.label=i[2],k.ops.push(c);break}i[2]&&k.ops.pop(),k.trys.pop();continue;}c=b.call(a,k)}catch(a){c=[6,a],h=0}finally{e=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}var e,h,i,j,k={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return j={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(j[Symbol.iterator]=function(){return this}),j}var ResourceLoader={add:function(){for(var a,b=[],c=0;c<arguments.length;c++)b[c]=arguments[c];Loader.shared.resources[b[0]]||(a=Loader.shared).add.apply(a,b)},Load:function(a,b){var c=this;Object.keys(a).map(function(d){var e=/\.(svg|png|gif|jpe?g)/.test(a[d]),f=/\.(json)/.test(a[d])||Array.isArray(a[d]),g=[d,a[d]],h=__assign({},b);if(Array.isArray(a[d])){var i=a[d].find(function(a){return /\.(svg|png|gif|jpe?g)/.test(a)}),j=a[d].find(function(a){return /\.(json)/.test(a)});i&&j&&(g[1]=j,h.metadata={jsonImage:i})}(e||f)&&g.push(h),c.add.apply(c,g)})},onLoaded:function(a){void 0===a&&(a=function(){}),Loader.shared.load(function(){return a(Loader.shared.resources)})}},Resource=function(){function a(){}return a.use=function(a){this.resourceGetters.push(a)},a.useLoad=function(a){this.resourceGetters.push(a),console.warn("'Resource.useLoad()' will be deprecated in next major version, use 'Resource.use()' to instead.")},a.getLoad=function(){var a=this.resourceGetters.filter(function(a){return"object"==typeof a}).reduce(function(a,b){return Object.assign(a,b)},{}),b=this.resourceGetters.filter(function(a){return"function"==typeof a}).reduce(function(a,b){return Object.assign(a,b())},{});return Object.assign(a,b)},a.optionSetting=function(a){this.options=a},a.Load=function(a){return void 0===a&&(a=function(){}),__awaiter(this,void 0,void 0,function(){var b=this;return __generator(this,function(){return ResourceLoader.Load(this.getLoad(),this.options),this.resourceGetters=[],this.state="Loading",[2,new Promise(function(c){return Loader.shared.load(function(){b.state="Loaded",c(Loader.shared.resources),a(Loader.shared.resources),b._onLoaded(Loader.shared.resources)})})]})})},a.onLoading=function(a){void 0===a&&(a=function(){}),Loader.shared.on("progress",function(b,c){return a(b.progress,c.name,c.url)})},a.onLoaded=function(a){void 0===a&&(a=function(){}),this._onLoaded=a},a._onLoaded=function(){},a.state="Loading",a.resourceGetters=[],a}(),Route=function(){function a(){}return a.push=function(a){this.scenes[a.name]=a},a.to=function(a,b){void 0===b&&(b={}),this.isScene(a)&&this.currentSceneName!==a&&(this.pendingSceneName=a,this.query=b,this.history.push(a),this.setCurrentScene(this.pendingSceneName))},a.back=function(a){void 0===a&&(a={}),1>=this.history.length||(this.history.pop(),this.to(this.history.pop(),a))},a.getQuery=function(a){return a?this.query[a]:this.query},a.update=function(){this.currentScene&&this.currentScene.canUpdate&&this.currentScene.update()},a.setCurrentScene=function(a){return this.isScene(a)?void(this.game.stage.children.map(function(a){return a.visible=!1}),this.currentScene=this.scenes[a],this.currentScene.stage.visible=!0,this.fetchNextScene(),this.stateUpdate(),this.onSceneChange()):console.warn("Scene "+a+" is not exist.")},a.fetchNextScene=function(){var a=this,b=this.game.stage.children.find(function(b){return b===a.currentScene.stage});if(b)this.currentScene.onShow();else{var c=this.currentScene.beforeCreate(),d=c instanceof Promise;d&&(this.beforeCreated=!1,c.then(function(){a.beforeCreated=!0,"Loaded"===Resource.state&&a.currentScene.create()})),this.currentScene.stage.visible=!0,this.game.stage.addChild(this.currentScene.stage),Resource.Load(function(){a.currentScene.onLoaded(Loader.shared.resources);var b=!d||d&&a.beforeCreated;b&&a.currentScene.create(),a.currentScene.onShow()}),Resource.onLoading(function(b,c,d){return a.currentScene.onLoading(b,c,d)}),this.pendingSceneName=""}},a.onSceneChange=function(){var a=this.scenes[this.prevSceneName];a&&(a.cleanStage?(a.destory(),this.game.stage.removeChild(a.stage)):a.onHide())},a.stateUpdate=function(){this.prevSceneName=this.currentSceneName,this.currentSceneName=this.currentScene.name},a.isScene=function(a){return void 0===a&&(a=""),void 0!==this.scenes[a]},a.scenes={},a.query={},a.history=[],a.beforeCreated=!1,a}();Ticker.shared.add(function(){return Route.update()});function getView(){if("undefined"!=typeof canvas)return canvas;var a=document.createElement("canvas");return document.body.appendChild(a),a}function remove(a){a.children.map(function(a){return remove(a)}),a.removeChildren()}var ScreenSize=function(){function a(){}return Object.defineProperty(a,"width",{get:function(){return window.innerWidth},enumerable:!0,configurable:!0}),Object.defineProperty(a,"height",{get:function(){return window.innerHeight},enumerable:!0,configurable:!0}),a}(),shared={};function getType(a){return a.text?"Text":a.fill?"Graphics":a.animationSpeed?"AnimatedSprite":a.isSprite?"Sprite":"Container"}var Stage=function(a){function b(b){var c=a.call(this)||this;return c.name=b,c.isStage=!0,c.sortableChildren=!0,c.init(),c}return __extends(b,a),b.prototype.init=function(){this.x=0,this.y=0,this.setSize()},b.prototype.setSize=function(){this.beginFill(16777215,0),this.drawRect(0,0,ScreenSize.width,ScreenSize.height),this.endFill()},b.prototype.onSceneChange=function(){this.init()},b.prototype.destory=function(){remove(this)},b}(Graphics),Scene=function(){function a(a){this.Loader=ResourceLoader,this.name=a,this.canUpdate=!1,this.ratios=this.game.PIXEL_RATIOS,this.stage=new Stage(a),Route.push(this)}return Object.defineProperty(a.prototype,"ratio",{get:function(){return this.game.PIXEL_RATIO},enumerable:!0,configurable:!0}),a.prototype.Load=function(){Resource.Load()},a.prototype.onLoading=function(){},a.prototype.onLoaded=function(){},a.prototype.beforeCreate=function(){},a.prototype.create=function(){},a.prototype.onShow=function(){},a.prototype.onHide=function(){},a.prototype.switchTo=function(a,b){void 0===b&&(b={}),Route.to(a,b)},a.prototype.getQuery=function(a){return Route.getQuery(a)},a.prototype.useUpdate=function(){this.canUpdate=!0},a.prototype.update=function(){!this.canUpdate},a.prototype.destory=function(){this.canUpdate=!1,this.stage.destory()},a}();function getGame(){return Scene.prototype.game}function getStage(){return getGame().stage.children.find(function(a){return a.name===Route.currentScene.name})}var Component=function(a){function b(){var b=a.call(this)||this;return b.game=getGame(),b.stage=getStage(),b.stage.addChild(b),b.ratios=b.game.PIXEL_RATIOS,b}return __extends(b,a),Object.defineProperty(b.prototype,"ratio",{get:function(){return this.game.PIXEL_RATIO},enumerable:!0,configurable:!0}),b}(Container),SizeComponent=function(a){function b(b,c,d,e,f,g,h){void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=ScreenSize.width),void 0===e&&(e=ScreenSize.height),void 0===f&&(f=0),void 0===g&&(g=16777215),void 0===h&&(h=0);var i=a.call(this)||this;return i.game=getGame(),i.stage=getStage(),i.color=16777215,i.opacity=0,i.frame={x:0,y:0,width:0,height:0,radius:0},i.stage.addChild(i),i.ratios=i.game.PIXEL_RATIOS,i.color=g,i.opacity=h,i.frame={x:b,y:c,width:d,height:e,radius:f},i.beginFill(i.color,i.opacity),i.drawRoundedRect(b,c,d,e,f),i.endFill(),i}return __extends(b,a),Object.defineProperty(b.prototype,"ratio",{get:function(){return this.game.PIXEL_RATIO},enumerable:!0,configurable:!0}),b.prototype.setSize=function(a,b,c){void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=this.frame.radius),this.clear(),this.frame.width=a,this.frame.height=b,this.frame.radius=c;var d=this.frame,e=d.x,f=d.y;this.beginFill(this.color,this.opacity),this.drawRoundedRect(e,f,a,b,c),this.endFill()},b}(Graphics);function createCommonjsModule(a,b){return b={exports:{}},a(b,b.exports),b.exports}var eventemitter3=createCommonjsModule(function(a){/**
 * Constructor to create a storage for our `EE` objects.
 * An `Events` instance is a plain object whose properties are event names.
 *
 * @constructor
 * @private
 */function b(){}//
// We try to not inherit from `Object.prototype`. In some engines creating an
// instance in this way is faster than calling `Object.create(null)` directly.
// If `Object.create(null)` is not supported we prefix the event names with a
// character to make sure that the built-in object properties are not
// overridden or used as an attack vector.
//
/**
 * Representation of a single event listener.
 *
 * @param {Function} fn The listener function.
 * @param {*} context The context to invoke the listener with.
 * @param {Boolean} [once=false] Specify if the listener is a one-time listener.
 * @constructor
 * @private
 */function c(a,b,c){this.fn=a,this.context=b,this.once=c||!1}/**
 * Add a listener for a given event.
 *
 * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.
 * @param {(String|Symbol)} event The event name.
 * @param {Function} fn The listener function.
 * @param {*} context The context to invoke the listener with.
 * @param {Boolean} once Specify if the listener is a one-time listener.
 * @returns {EventEmitter}
 * @private
 */function d(a,b,d,e,f){if("function"!=typeof d)throw new TypeError("The listener must be a function");var g=new c(d,e||a,f),i=h?h+b:b;return a._events[i]?a._events[i].fn?a._events[i]=[a._events[i],g]:a._events[i].push(g):(a._events[i]=g,a._eventsCount++),a}/**
 * Clear event by name.
 *
 * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.
 * @param {(String|Symbol)} evt The Event name.
 * @private
 */function e(a,c){0==--a._eventsCount?a._events=new b:delete a._events[c]}/**
 * Minimal `EventEmitter` interface that is molded against the Node.js
 * `EventEmitter` interface.
 *
 * @constructor
 * @public
 */function f(){this._events=new b,this._eventsCount=0}/**
 * Return an array listing the events for which the emitter has registered
 * listeners.
 *
 * @returns {Array}
 * @public
 */var g=Object.prototype.hasOwnProperty,h="~";/**
 * Return the listeners registered for a given event.
 *
 * @param {(String|Symbol)} event The event name.
 * @returns {Array} The registered listeners.
 * @public
 */ /**
 * Return the number of listeners listening to a given event.
 *
 * @param {(String|Symbol)} event The event name.
 * @returns {Number} The number of listeners.
 * @public
 */ /**
 * Calls each of the listeners registered for a given event.
 *
 * @param {(String|Symbol)} event The event name.
 * @returns {Boolean} `true` if the event had listeners, else `false`.
 * @public
 */ /**
 * Add a listener for a given event.
 *
 * @param {(String|Symbol)} event The event name.
 * @param {Function} fn The listener function.
 * @param {*} [context=this] The context to invoke the listener with.
 * @returns {EventEmitter} `this`.
 * @public
 */ /**
 * Add a one-time listener for a given event.
 *
 * @param {(String|Symbol)} event The event name.
 * @param {Function} fn The listener function.
 * @param {*} [context=this] The context to invoke the listener with.
 * @returns {EventEmitter} `this`.
 * @public
 */ /**
 * Remove the listeners of a given event.
 *
 * @param {(String|Symbol)} event The event name.
 * @param {Function} fn Only remove the listeners that match this function.
 * @param {*} context Only remove the listeners that have this context.
 * @param {Boolean} once Only remove one-time listeners.
 * @returns {EventEmitter} `this`.
 * @public
 */ /**
 * Remove all listeners, or those of the specified event.
 *
 * @param {(String|Symbol)} [event] The event name.
 * @returns {EventEmitter} `this`.
 * @public
 */ //
// Alias methods names because people roll like that.
//
//
// Expose the prefix.
//
//
// Allow `EventEmitter` to be imported as module namespace.
//
Object.create&&(b.prototype=Object.create(null),!new b().__proto__&&(h=!1)),f.prototype.eventNames=function(){var a,b,c=[];if(0===this._eventsCount)return c;for(b in a=this._events)g.call(a,b)&&c.push(h?b.slice(1):b);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(a)):c},f.prototype.listeners=function(a){var b=h?h+a:a,c=this._events[b];if(!c)return[];if(c.fn)return[c.fn];for(var d=0,e=c.length,f=Array(e);d<e;d++)f[d]=c[d].fn;return f},f.prototype.listenerCount=function(a){var b=h?h+a:a,c=this._events[b];return c?c.fn?1:c.length:0},f.prototype.emit=function(a,b,c,d,e,f){var g=h?h+a:a;if(!this._events[g])return!1;var k,l,m=this._events[g],n=arguments.length;if(m.fn){switch(m.once&&this.removeListener(a,m.fn,void 0,!0),n){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,b),!0;case 3:return m.fn.call(m.context,b,c),!0;case 4:return m.fn.call(m.context,b,c,d),!0;case 5:return m.fn.call(m.context,b,c,d,e),!0;case 6:return m.fn.call(m.context,b,c,d,e,f),!0;}for(l=1,k=Array(n-1);l<n;l++)k[l-1]=arguments[l];m.fn.apply(m.context,k)}else{var o,p=m.length;for(l=0;l<p;l++)switch(m[l].once&&this.removeListener(a,m[l].fn,void 0,!0),n){case 1:m[l].fn.call(m[l].context);break;case 2:m[l].fn.call(m[l].context,b);break;case 3:m[l].fn.call(m[l].context,b,c);break;case 4:m[l].fn.call(m[l].context,b,c,d);break;default:if(!k)for(o=1,k=Array(n-1);o<n;o++)k[o-1]=arguments[o];m[l].fn.apply(m[l].context,k);}}return!0},f.prototype.on=function(a,b,c){return d(this,a,b,c,!1)},f.prototype.once=function(a,b,c){return d(this,a,b,c,!0)},f.prototype.removeListener=function(a,b,c,d){var f=h?h+a:a;if(!this._events[f])return this;if(!b)return e(this,f),this;var g=this._events[f];if(g.fn)g.fn!==b||d&&!g.once||c&&g.context!==c||e(this,f);else{for(var j=0,k=[],l=g.length;j<l;j++)(g[j].fn!==b||d&&!g[j].once||c&&g[j].context!==c)&&k.push(g[j]);//
// Reset the array, or remove it completely if we have no more listeners.
//
k.length?this._events[f]=1===k.length?k[0]:k:e(this,f)}return this},f.prototype.removeAllListeners=function(a){var c;return a?(c=h?h+a:a,this._events[c]&&e(this,c)):(this._events=new b,this._eventsCount=0),this},f.prototype.off=f.prototype.removeListener,f.prototype.addListener=f.prototype.on,f.prefixed=h,f.EventEmitter=f,a.exports=f}),event=new eventemitter3;function createScene(a,b){var c=Object.keys(b).map(function(a){return a.toLowerCase()}),d=Object.values(b);event.emit("created",{game:a}),d.map(function(a,b){return new a(c[b])}),Route.game=a,Route.to(c[0])}var defaultConfigure={backgroundColor:0,autoResize:!0,width:ScreenSize.width,height:ScreenSize.height,UIWidth:ScreenSize.width,UIHeight:ScreenSize.height,resolution:devicePixelRatio};function extendGame(a,b){var c=a.Loader,d=b.game;d.Loader=c,d.resources=c.shared.resources,Scene.prototype.game=d;var e=d.configure,f=e.UIWidth,g=e.UIHeight,h=d.view.width/d.configure.resolution,i=d.view.height/d.configure.resolution;d.PIXEL_RATIOS=shared.PIXEL_RATIOS={x:h/f,y:i/g},Object.defineProperty(d,"PIXEL_RATIO",{get:function(){return f<g?d.PIXEL_RATIOS.x:d.PIXEL_RATIOS.y}})}function createGame(a){var b=a.view;a=Object.assign(defaultConfigure,a),a.view=b||getView(),event.emit("beforeCreate",{PIXI:PIXI,Scene:Scene,Resource:Resource,ResourceLoader:ResourceLoader,Stage:Stage,Route:Route,Component:Component});var c=new Application(a);return c.configure=a,extendGame(PIXI,{game:c}),createScene(c,a.scenes),c}function use(a){Array.isArray(a)?a.map(function(a){return a(event)}):"function"==typeof a?a(event):console.error("extendsion "+a+" must be a function")}window.PIXI=PIXI;export{Component,Resource,ResourceLoader,Route,Scene,SizeComponent,createGame,createScene,event,getGame,getStage,getType,shared,use};
//# sourceMappingURL=scene.es.min.js.map
