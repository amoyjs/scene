import*as PIXI from"pixi.js";import{Ticker,Loader,Graphics,Container,Application}from"pixi.js";var Route=/** @class */function(){function a(){}return a.push=function(a){this.scenes[a.name]=a},a.to=function(a,b){void 0===b&&(b={}),this.isScene(a)&&this.currentSceneName!==a&&(this.pendingSceneName=a,this.query=b,this.history.push(a),this.setCurrentScene(this.pendingSceneName))},a.back=function(a){void 0===a&&(a={}),1>=this.history.length||(this.history.pop(),this.to(this.history.pop(),a))},a.getQuery=function(a){return a?this.query[a]:this.query},a.update=function(){this.currentScene&&this.currentScene.canUpdate&&this.currentScene.update()},a.setCurrentScene=function(a){return this.isScene(a)?void(// hide all scenes
// set current scene
this.game.stage.children.map(function(a){return a.visible=!1}),this.currentScene=this.scenes[a],this.currentScene.stage.visible=!0,this.fetchNextScene(),this.stateUpdate(),this.onSceneChange()):console.warn("Scene "+a+" is not exist.")},a.fetchNextScene=function(){var a=this,b=this.game.stage.children.find(function(b){return b===a.currentScene.stage});b||(this.currentScene.stage.visible=!0,this.game.stage.addChild(this.currentScene.stage),this.currentScene.Load(),Loader.shared.load(function(){a.currentScene.onLoaded(Loader.shared.resources),a.currentScene.autoCreate&&a.currentScene.create()}),Loader.shared.on("progress",function(b,c){return a.currentScene.onLoading(b.progress,c.name,c.url)}),this.pendingSceneName=null)},a.onSceneChange=function(){if(this.prevSceneName){var a=this.scenes[this.prevSceneName];a.cleanStage&&(a.destory(),this.game.stage.removeChild(a.stage))}},a.stateUpdate=function(){this.prevSceneName=this.currentSceneName,this.currentSceneName=this.currentScene.name},a.isScene=function(a){return void 0===a&&(a=""),void 0!==this.scenes[a]},a.scenes={},a.query={},a.history=[],a}();Ticker.shared.add(function(){return Route.update()});var ResourceLoader={add:function(){for(var a,b=[],c=0;c<arguments.length;c++)b[c]=arguments[c];Loader.shared.resources[b[0]]||(a=Loader.shared).add.apply(a,b)},Load:function(a){var b=this;Object.keys(a).map(function(c){return b.add(c,a[c])})},onLoaded:function(a){void 0===a&&(a=function(){}),Loader.shared.load(function(){return a(Loader.shared.resources)})}},Resource=/** @class */function(){function a(){}return a.use=function(a){this.resourceGetters.push(a)},a.useLoad=function(a){this.resourceGetters.push(a),console.warn("'Resource.useLoad()' will be deprecated in next major version, use 'Resource.use()' to instead.")},a.getLoad=function(){var a=this.resourceGetters.filter(function(a){return"object"==typeof a}).reduce(function(a,b){return Object.assign(a,b)},{}),b=this.resourceGetters.filter(function(a){return"function"==typeof a}).reduce(function(a,b){return Object.assign(a,b())},{});return Object.assign(a,b)},a.Load=function(a){void 0===a&&(a=function(){}),ResourceLoader.Load(this.getLoad()),this.resourceGetters=[],Loader.shared.load(function(){return a(Loader.shared.resources)})},a.onLoading=function(a){void 0===a&&(a=function(){}),Loader.shared.on("progress",function(b,c){return a(b.progress,c.name,c.url)})},a.resourceGetters=[],a}(),extendStatics=function(a,c){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,c){a.__proto__=c}||function(a,c){for(var b in c)c.hasOwnProperty(b)&&(a[b]=c[b])},extendStatics(a,c)};function __extends(a,c){function b(){this.constructor=a}extendStatics(a,c),a.prototype=null===c?Object.create(c):(b.prototype=c.prototype,new b)}function getView(){if("undefined"!=typeof canvas)return canvas;var a=document.createElement("canvas");return document.body.appendChild(a),a}function remove(a){a.children.map(function(a){return remove(a)}),a.removeChildren()}var ScreenSize=/** @class */function(){function a(){}return Object.defineProperty(a,"width",{get:function(){return window.innerWidth},enumerable:!0,configurable:!0}),Object.defineProperty(a,"height",{get:function(){return window.innerHeight},enumerable:!0,configurable:!0}),a}(),shared={};function getType(a){return a.text?"Text":a.fill?"Graphics":a.animationSpeed?"AnimatedSprite":a.isSprite?"Sprite":"Container"}var Stage=/** @class */function(a){function b(b){var c=a.call(this)||this;return c.name=b,c.isStage=!0,c.sortableChildren=!0,c.init(),c}return __extends(b,a),b.prototype.init=function(){this.x=0,this.y=0,this.setSize()},b.prototype.setSize=function(){this.beginFill(16777215,0),this.drawRect(0,0,ScreenSize.width,ScreenSize.height),this.endFill()},b.prototype.onSceneChange=function(){this.init()},b.prototype.destory=function(){remove(this)},b}(Graphics),Scene=/** @class */function(){function a(a){this.Loader=ResourceLoader,this.autoCreate=!0,this.name=a,this.canUpdate=!1,this.ratios=this.game.PIXEL_RATIOS,this.stage=new Stage(a),Route.push(this)}return Object.defineProperty(a.prototype,"ratio",{get:function(){return this.game.PIXEL_RATIO},enumerable:!0,configurable:!0}),a.prototype.Load=function(){Resource.Load()},a.prototype.onLoading=function(){},a.prototype.onLoaded=function(){},a.prototype.create=function(){},a.prototype.switchTo=function(a,b){void 0===b&&(b={}),Route.to(a,b)},a.prototype.getQuery=function(a){return Route.getQuery(a)},a.prototype.useUpdate=function(){this.canUpdate=!0},a.prototype.update=function(){if(!this.canUpdate)return!1},a.prototype.destory=function(){this.canUpdate=!1,this.stage.destory()},a}();function getGame(){return Scene.prototype.game}function getStage(){return getGame().stage.children.find(function(a){return a.name===Route.currentScene.name})}var Component=/** @class */function(a){function b(){var b=a.call(this)||this;return b.game=getGame(),b.stage=getStage(),b.stage.addChild(b),b.ratios=b.game.PIXEL_RATIOS,b}return __extends(b,a),Object.defineProperty(b.prototype,"ratio",{get:function(){return this.game.PIXEL_RATIO},enumerable:!0,configurable:!0}),b}(Container),SizeComponent=/** @class */function(a){function b(b,c,d,e,f,g,h){void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=ScreenSize.width),void 0===e&&(e=ScreenSize.height),void 0===f&&(f=0),void 0===g&&(g=16777215),void 0===h&&(h=0);var i=a.call(this)||this;return i.game=getGame(),i.stage=getStage(),i.color=16777215,i.opacity=0,i.frame={x:0,y:0,width:0,height:0,radius:0},i.stage.addChild(i),i.ratios=i.game.PIXEL_RATIOS,i.color=g,i.opacity=h,i.frame={x:b,y:c,width:d,height:e,radius:f},i.beginFill(i.color,i.opacity),i.drawRoundedRect(b,c,d,e,f),i.endFill(),i}return __extends(b,a),Object.defineProperty(b.prototype,"ratio",{get:function(){return this.game.PIXEL_RATIO},enumerable:!0,configurable:!0}),b.prototype.setSize=function(a,b,c){void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=this.frame.radius),this.clear(),this.frame.width=a,this.frame.height=b,this.frame.radius=c;var d=this.frame,e=d.x,f=d.y;this.beginFill(this.color,this.opacity),this.drawRoundedRect(e,f,a,b,c),this.endFill()},b}(Graphics),extensions=[];function use(a){Array.isArray(a)?a.map(function(a){return extensions.push(a)}):"function"==typeof a?extensions.push(a):console.error("extendsion "+a+" must be a function")}function createScene(a,b){var c=Object.keys(b).map(function(a){return a.toLowerCase()}),d=Object.values(b);extensions.map(function(b){return b(PIXI,{game:a,Scene:Scene,Resource:Resource,ResourceLoader:ResourceLoader,Stage:Stage,Route:Route})}),d.map(function(a,b){return new a(c[b])}),Route.game=a,Route.to(c[0])}var defaultConfigure={backgroundColor:0,autoResize:!0,width:ScreenSize.width,height:ScreenSize.height,UIWidth:ScreenSize.width,UIHeight:ScreenSize.height,resolution:devicePixelRatio};function extendGame(a,b){var c=a.Loader,d=b.game;d.Loader=c,d.resources=c.shared.resources,Scene.prototype.game=d;var e=d.configure,f=e.UIWidth,g=e.UIHeight,h=d.view.width/d.configure.resolution,i=d.view.height/d.configure.resolution;// 竖屏应用，以宽为准；横屏应用，以高为准
d.PIXEL_RATIOS=shared.PIXEL_RATIOS={x:h/f,y:i/g},Object.defineProperty(d,"PIXEL_RATIO",{get:function(){return f<g?d.PIXEL_RATIOS.x:d.PIXEL_RATIOS.y}})}var Game=Application;function createGame(a){var b=a.view;a=Object.assign(defaultConfigure,a),a.view=b||getView(),extensions.map(function(a){return a(PIXI,{Scene:Scene,Resource:Resource,ResourceLoader:ResourceLoader,Stage:Stage,Route:Route,Component:Component})});var c=new Game(a);return c.configure=a,extendGame(PIXI,{game:c}),createScene(c,a.scenes),c}window.PIXI=PIXI;export{Component,Resource,ResourceLoader,Route,Scene,SizeComponent,createGame,createScene,getGame,getStage,getType,shared,use};
//# sourceMappingURL=scene.es.min.js.map
