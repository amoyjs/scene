import*as PIXI from"pixi.js";import{Loader,Renderer,Graphics,Application,Container}from"pixi.js";var Route=/** @class */function(){function a(a){this.game=a,this.scenes={},this.query={}}return a.create=function(b){return this.instance||(this.instance=new a(b)),this.instance},a.prototype.push=function(a){this.scenes[a.name]=a},a.prototype.to=function(a,b){return void 0===b&&(b={}),this.currentSceneName!==a&&void(this.isScene(a)&&(this.pendingSceneName=a,this.query=b))},a.prototype.update=function(){this.pendingSceneName&&this.setCurrentScene(this.pendingSceneName),this.currentScene&&this.currentScene.canUpdate&&this.currentScene.update&&this.currentScene.update()},a.prototype.setCurrentScene=function(a){return this.isScene(a)?void(this.currentSceneName!==this.pendingSceneName&&(this.currentScene=this.scenes[a],this.cleanStage(),this.fetchNextScene(),this.stateUpdate(),this.onSceneChange())):(console.warn("\u573A\u666F "+a+" \u4E0D\u5B58\u5728"),!1)},a.prototype.cleanStage=function(){this.game.stage.removeChildren()},a.prototype.fetchNextScene=function(){var a=this;this.game.stage.addChild(this.currentScene.stage),this.currentScene.Load(),Loader.shared.load(function(){return a.currentScene.create()}),Loader.shared.on("progress",function(b,c){return a.currentScene.onLoading(b.progress,c.name,c.url)}),this.pendingSceneName=null},a.prototype.stateUpdate=function(){this.prevSceneName=this.currentSceneName,this.currentSceneName=this.currentScene.name},a.prototype.onSceneChange=function(){if(this.prevSceneName){var a=this.scenes[this.prevSceneName];a.shutdown(),this.game.stage.removeChild(a.stage)}this.currentScene.stage.onSceneChange()},a.prototype.isScene=function(a){void 0===a&&(a="");var b=void 0!==this.scenes[a];return b},a.prototype.destroy=function(){this.game=null,this.scenes={},this.pendingSceneName=null,this.currentSceneName=null,this.currentScene=null},a}(),Scene=/** @class */function(){function a(b){var c=this;this.name=b,this.canUpdate=!1,this.ratio=this.game.PIXEL_RATIO.x,this.ratios=this.game.PIXEL_RATIO,a.addons.map(function(a){return a.call(c)})}return a.use=function(a){var b=this;Array.isArray(a)?a.map(function(a){return b.use(a)}):this.addons.push(a)},Object.defineProperty(a.prototype,"Loader",{get:function(){return{add:function(){for(var a,b=[],c=0;c<arguments.length;c++)b[c]=arguments[c];Loader.shared.resources[b[0]]||(a=Loader.shared).add.apply(a,b)},Load:function(a){var b=this;Object.keys(a).map(function(c){return b.add(c,a[c])})},onLoaded:function(a){void 0===a&&(a=function(){}),Loader.shared.load(function(){return a()})}}},enumerable:!0,configurable:!0}),a.prototype.Load=function(){this.Loader.Load(this.getLoad())},a.prototype.getLoad=function(){return a.resourceGetters.reduce(function(a,b){return a=Object.assign(a,b()),a},{})},a.useLoad=function(a){this.resourceGetters.push(a)},a.prototype.switchTo=function(a,b){void 0===b&&(b={}),this.route.to(a,b)},a.prototype.getQuery=function(a){return a?this.route.query[a]:this.route.query},a.prototype.create=function(){},a.prototype.onLoading=function(){},a.prototype.useUpdate=function(){this.canUpdate=!0},a.prototype.update=function(){if(!this.canUpdate)return!1},a.prototype.shutdown=function(a){void 0===a&&(a=!0),this.canUpdate=!1,a&&this.stage.shutdown()},a.addons=[],a.resourceGetters=[],a}(),extendStatics=function(a,c){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,c){a.__proto__=c}||function(a,c){for(var b in c)c.hasOwnProperty(b)&&(a[b]=c[b])},extendStatics(a,c)};function __extends(a,c){function b(){this.constructor=a}extendStatics(a,c),a.prototype=null===c?Object.create(c):(b.prototype=c.prototype,new b)}/*!
 * @pixi/unsafe-eval - v5.0.4
 * Compiled Fri, 07 Jun 2019 17:17:49 UTC
 *
 * @pixi/unsafe-eval is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */ // cv = CachedValue
// v = value
// ud = uniformData
// uv = uniformValue
// l = location
/* eslint-disable max-len */var GLSL_TO_SINGLE_SETTERS={float:function(a,b,c,d){c!==d&&(c.v=d,a.uniform1f(b,d))},vec2:function(a,b,c,d){(c[0]!==d[0]||c[1]!==d[1])&&(c[0]=d[0],c[1]=d[1],a.uniform2f(b,d[0],d[1]))},vec3:function(a,b,c,d){(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2])&&(c[0]=d[0],c[1]=d[1],c[2]=d[2],a.uniform3f(b,d[0],d[1],d[2]))},int:function(a,b,c,d){a.uniform1i(b,d)},ivec2:function(a,b,c,d){a.uniform2i(b,d[0],d[1])},ivec3:function(a,b,c,d){a.uniform3i(b,d[0],d[1],d[2])},ivec4:function(a,b,c,d){a.uniform4i(b,d[0],d[1],d[2],d[3])},bool:function(a,b,c,d){a.uniform1i(b,d)},bvec2:function(a,b,c,d){a.uniform2i(b,d[0],d[1])},bvec3:function(a,b,c,d){a.uniform3i(b,d[0],d[1],d[2])},bvec4:function(a,b,c,d){a.uniform4i(b,d[0],d[1],d[2],d[3])},mat2:function(a,b,c,d){a.uniformMatrix2fv(b,!1,d)},mat3:function(a,b,c,d){a.uniformMatrix3fv(b,!1,d)},mat4:function(a,b,c,d){a.uniformMatrix4fv(b,!1,d)},sampler2D:function(a,b,c,d){a.uniform1i(b,d)},samplerCube:function(a,b,c,d){a.uniform1i(b,d)},sampler2DArray:function(a,b,c,d){a.uniform1i(b,d)}},GLSL_TO_ARRAY_SETTERS={float:function(a,b,c,d){a.uniform1fv(b,d)},vec2:function(a,b,c,d){a.uniform2fv(b,d)},vec3:function(a,b,c,d){a.uniform3fv(b,d)},vec4:function(a,b,c,d){a.uniform4fv(b,d)},int:function(a,b,c,d){a.uniform1iv(b,d)},ivec2:function(a,b,c,d){a.uniform2iv(b,d)},ivec3:function(a,b,c,d){a.uniform3iv(b,d)},ivec4:function(a,b,c,d){a.uniform4iv(b,d)},bool:function(a,b,c,d){a.uniform1iv(b,d)},bvec2:function(a,b,c,d){a.uniform2iv(b,d)},bvec3:function(a,b,c,d){a.uniform3iv(b,d)},bvec4:function(a,b,c,d){a.uniform4iv(b,d)},sampler2D:function(a,b,c,d){a.uniform1iv(b,d)},samplerCube:function(a,b,c,d){a.uniform1iv(b,d)},sampler2DArray:function(a,b,c,d){a.uniform1iv(b,d)}};/* eslint-disable max-len */function syncUniforms(a,b,c,d,e){var f=0,g=null,h=null,j=e.gl;for(var k in a.uniforms){var i=b[k],l=d[k],m=c[k],n=a.uniforms[k];if(!i){n.group&&e.shader.syncUniformGroup(l);continue}if("float"===i.type&&1===i.size)l!==m.value&&(m.value=l,j.uniform1f(m.location,l));/* eslint-disable max-len */else if(("sampler2D"===i.type||"samplerCube"===i.type||"sampler2DArray"===i.type)&&1===i.size&&!i.isArray)/* eslint-disable max-len */e.texture.bind(l,f),m.value!==f&&(m.value=f,j.uniform1i(m.location,f)),f++;else if("mat3"===i.type&&1===i.size)void 0===n.a?j.uniformMatrix3fv(m.location,!1,l):j.uniformMatrix3fv(m.location,!1,l.toArray(!0));else if("vec2"===i.type&&1===i.size)void 0===n.x?(h=m.value,g=l,(h[0]!==g[0]||h[1]!==g[1])&&(h[0]=g[0],h[1]=g[1],j.uniform2f(m.location,g[0],g[1]))):(h=m.value,g=l,(h[0]!==g.x||h[1]!==g.y)&&(h[0]=g.x,h[1]=g.y,j.uniform2f(m.location,g.x,g.y)));else if("vec4"===i.type&&1===i.size)void 0===n.width?(h=m.value,g=l,(h[0]!==g[0]||h[1]!==g[1]||h[2]!==g[2]||h[3]!==g[3])&&(h[0]=g[0],h[1]=g[1],h[2]=g[2],h[3]=g[3],j.uniform4f(m.location,g[0],g[1],g[2],g[3]))):(h=m.value,g=l,(h[0]!==g.x||h[1]!==g.y||h[2]!==g.width||h[3]!==g.height)&&(h[0]=g.x,h[1]=g.y,h[2]=g.width,h[3]=g.height,j.uniform4f(m.location,g.x,g.y,g.width,g.height)));else{var o=1===i.size?GLSL_TO_SINGLE_SETTERS:GLSL_TO_ARRAY_SETTERS;o[i.type].call(null,j,m.location,m.value,l)}}}function install(a){if(!a||!a.systems||!a.systems.ShaderSystem)throw new Error("Unable to patch ShaderSystem, class not found.");var b=a.systems,c=b.ShaderSystem,d=!1;// Do a quick check to see if the patch is needed
// want to make sure we only apply if necessary!
try{c.prototype.systemCheck.call(null),d=!1}catch(a){d=!0}// Only apply if needed
d&&Object.assign(c.prototype,{systemCheck:function(){// do nothing, don't throw error
},syncUniforms:function(a,b){var c=this,d=c.shader,e=c.renderer;/* eslint-disable max-len */syncUniforms(a,d.program.uniformData,b.uniformData,a.uniforms,e)}})}function compatibleWeChatGame(){// @ts-ignore
"function"!=typeof eval&&install(PIXI),Renderer.create=function(a){return new Renderer(a)}}function getView(){if("undefined"!=typeof canvas)return canvas;var a=document.createElement("canvas");return document.body.appendChild(a),a}function usesify(a){return function b(c){Array.isArray(c)?c.map(function(a){return b(a)}):"function"==typeof c?c(a):console.error("addon "+c+" must be a function")}}function remove(a){a.children.map(function(a){return remove(a)}),a.removeChildren()}var Stage=/** @class */function(a){function b(b){var c=a.call(this)||this;return c.game=b,c.isStage=!0,c.init(),c}return __extends(b,a),b.prototype.init=function(){this.x=0,this.y=0,this.setSize()},b.prototype.setSize=function(){this.beginFill(16777215,0),this.drawRect(0,0,this.game.view.width,this.game.view.height),this.endFill()},b.prototype.onSceneChange=function(){this.init()},b.prototype.shutdown=function(){remove(this)},b}(Graphics);Scene.use(function(){this.stage=new Stage(this.game),this.route=Route.create(this.game),this.route.push(this)});function useScene(a,b){var c=Object.keys(b).map(function(a){return a.toLowerCase()}),d=Object.values(b);Scene.prototype.game=a,d.map(function(a,b){return new a(c[b])});var e=Route.create(a);e.to(c[0]),a.ticker.add(function(){return e.update()})}var defaultConfigure={backgroundColor:0,autoResize:!0,width:window.innerWidth,height:window.innerHeight};function createGame(a){var b=a.view;a=Object.assign(defaultConfigure,a);var c=a.UIWidth,d=a.UIHeight,e=a.width,f=a.height,g=a.scenes;a.view=b||getView();var h=new Application(a);return h.Loader=Loader,h.resources=Loader.shared.resources,c&&d?(h.UI_DESIGN_RATIO=e/c,h.PIXEL_RATIO={x:e/c,y:f/d}):console.warn("must specified both \"options.UIWidth\" and \"options.UIHeight\" in createGame(options), or you can not use \"game.PIXEL_RATIO\" correctly."),useScene(h,g),h}var Component=/** @class */function(a){function b(){var b=a.call(this)||this;return b.game=Scene.prototype.game,b.stage=b.game.stage,b.stage.addChild(b),b.ratio=b.game.PIXEL_RATIO.x,b.ratios=b.game.PIXEL_RATIO,b}return __extends(b,a),b}(Container),SizeComponent=/** @class */function(a){function b(b,c,d,e,f){void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=window.innerWidth),void 0===e&&(e=window.innerHeight),void 0===f&&(f=0);var g=a.call(this)||this;return g.game=Scene.prototype.game,g.stage=g.game.stage,g.color=16777215,g.opacity=0,g.frame={x:0,y:0,width:0,height:0,radius:0},g.stage.addChild(g),g.ratio=g.game.PIXEL_RATIO.x,g.ratios=g.game.PIXEL_RATIO,g.frame={x:b,y:c,width:d,height:e,radius:f},g.beginFill(g.color,g.opacity),g.drawRoundedRect(b,c,d,e,f),g.endFill(),g}return __extends(b,a),b.prototype.setSize=function(a,b,c){void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=this.frame.radius),this.clear(),this.frame.width=a,this.frame.height=b,this.frame.radius=c;var d=this.frame,e=d.x,f=d.y;this.beginFill(this.color,this.opacity),this.drawRoundedRect(e,f,a,b,c),this.endFill()},b}(Graphics),use=usesify(PIXI);compatibleWeChatGame(),window.PIXI=PIXI;export{Component,Scene,SizeComponent,createGame,use,useScene};
//# sourceMappingURL=scene.es.min.js.map
